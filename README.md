

# Obsidian XFDF Importer
一个为 Obsidian 设计的插件，能够智能地将 PDF-XChange Editor 等工具导出的 XFDF 格式注释，导入到你的 Markdown 笔记中。它不仅能创建注释，还能在后续导入时智能地保留你的手动修改。
## ✨ 核心功能
- **一键导入**：通过一个简单的命令，即可将指定文件夹下的所有 `.xfdf` 文件中的注释导入到目标 Markdown 文件。
- **智能解析**：支持高亮、下划线、删除线、文本框、自由文本等多种注释类型。
- **精准跳转**：生成的链接可以直接调用 `pxce` 协议，在 PDF-XChange Editor 中精准定位到对应的注释和页面。
- **智能更新**：这是本插件的核心亮点。当你重新导入时，它会：
    - ✅ **保留你手动添加的任何内容**（如文字、空行、图片等）。
    - ✅ **智能更新已变更的注释链接**（如页码或注释内容变化）。
    - ✅ **保护你手动修改过的注释行**，防止被意外覆盖。
    - ✅ **自动添加新增的注释**。
- **无缝集成**：完美融入你的 Obsidian 工作流，注释链接与你的笔记内容共存。

## 🚀 快速开始
### 安装
1. 下载本仓库的 Releases 中的 `main.js`、`manifest.json` 和 `styles.css`（如果存在）文件。
2. 在你的 Obsidian 库路径下创建一个新文件夹，例如 `xfdf-importer`。
3. 将下载的三个文件复制到该文件夹中。
4. 在 Obsidian 设置 → 社区插件 → 已安装插件中，关闭“安全模式”，然后启用 "XFDF Importer" 插件。
### 配置
1. 启用插件后，在 Obsidian 设置中找到 "XFDF Importer" 插件设置页。
2. **XFDF Folder Path**: 设置存放 `.xfdf` 文件的文件夹路径（相对于你的库根目录）。例如：`PDFxchangeAnnot`。
3. **Target Markdown File**: 设置一个 Markdown 文件路径，用于存放导入的注释。例如：`快速笔记/Annotation.md`。
### 使用
1. 在 PDF-XChange Editor 中为 PDF 添加注释并保存 XFDF 文件到你配置的文件夹。
2. 在 Obsidian 中打开命令面板（`Ctrl/Cmd+P`）。
3. 运行 `Import XFDF Annotations` 命令。
4. 插件会自动处理所有 XFDF 文件，并将注释更新到你指定的 Markdown 文件中。

## 📝 注释格式
插件会生成如下格式的注释链接：

```markdown
# 我的PDF文档
- Highlight: 这是一段重点内容 [我的PDF文档：第2页](pxce:file:///...) <!-- a1b2c3d4-e5f6-7890-abcd-ef1234567890 -->
- Text: 这是一个笔记 [我的PDF文档：第2页](pxce:file:///...) <!-- b2c3d4e5-f6g7-8901-bcde-f23456789012 -->
```

- **`<!-- ... -->`**: 这是注释的唯一标识符，用于智能更新，请勿手动修改。
- **`pxce:...`**: 这是用于精准跳转的链接，点击后会在 PDF-XChange Editor 中打开对应位置。
- 
## 🧠 智能更新详解
当你再次运行导入命令时，插件会：
- **保留你的自定义内容**：在标题下，所有非插件生成的行（如你的笔记、想法、空行）都会被完整保留。
- **智能判断是否更新**：
    - 如果一个注释链接的**核心部分**（即 `pxce` 链接）发生了变化，插件会用新的链接替换它。
    - 如果你在一个注释行的**末尾**添加了任何内容（例如 `[tag:: important]`），插件会认为你手动修改了这一行，从而**完全保留它**，不会进行更新。
    
## 开源形式：
GPLv3

## 🛠️ 开发
本项目使用 TypeScript 开发。
```bash
# 安装依赖
npm install
# 编译
npm run build
```
